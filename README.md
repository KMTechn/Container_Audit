# Container Audit - 이적 검사 시스템 (v2.0.7)

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://python.org)
[![License](https://img.shields.io/badge/License-Proprietary-red.svg)]()
[![Platform](https://img.shields.io/badge/Platform-Windows-lightgrey.svg)]()

KMTech 제조업 이적 검사를 위한 실시간 데스크톱 애플리케이션입니다.

> **📋 문서 구성**
> • **사용자 가이드**: 이 README의 하단부 ([🚀 프로그램 사용법](#🚀-프로그램-사용법) 섹션)
> • **개발자 가이드**: 이 README 전체
> • **API 문서**: 소스 코드 내 주석 참조

## 📝 프로그램 개요

**이적 검사 시스템**은 제조업 생산 라인에서 완제품의 최종 검사를 수행하고 데이터를 관리하기 위해 개발된 전문 품질관리 솔루션입니다. 바코드 스캐너를 통한 빠르고 정확한 검사 작업이 가능하며, 모든 작업 내역은 자동으로 로그 파일로 저장되어 완벽한 추적성을 보장합니다.

### 🎯 핵심 가치
- **실시간 이적 데이터 수집**: 생산 현장의 모든 검사 데이터를 즉시 기록
- **하드웨어 통합**: 바코드 스캐너와의 완벽한 연동
- **간편한 작업 플로우**: 현품표 → 제품 스캔 → 완료의 직관적 워크플로우
- **데이터 무결성**: 자동 저장, 복구 시스템으로 데이터 손실 방지

## 🏗️ 시스템 아키텍처

### 애플리케이션 구조

```
Container Audit (2,215 Lines)
├── ContainerAudit (메인 GUI 클래스)
├── TraySession (트레이 세션 데이터)
├── ProductExchangeSession (개별 제품 교환 데이터)
└── 자동 업데이트 시스템
```

### 핵심 컴포넌트 분석

| 컴포넌트 | 라인수 | 주요 역할 |
|---------|--------|-----------|
| **ContainerAudit** | ~2,100 | 메인 GUI 및 비즈니스 로직 |
| **TraySession** | ~20 | 트레이 세션 데이터 구조 |
| **ProductExchangeSession** | ~10 | 개별 제품 교환 데이터 구조 |
| **자동 업데이트** | ~85 | GitHub 기반 자동 업데이트 |

### 데이터 플로우

```
바코드스캐너 → 메인앱 → 트레이처리 → UI업데이트 → 이벤트로깅 → CSV저장 → 오디오피드백
```

## 💻 개발 환경

### 시스템 요구사항

**운영체제**: Windows 10 이상
**Python**: 3.11+
**필수 디렉토리**: `C:\Sync` (로그 저장소)

### 의존성 설치

```bash
# 필수 패키지 설치
pip install -r requirements.txt

# 의존성 목록
requests    # GitHub API 통신
pygame     # 오디오 피드백
Pillow     # 이미지 처리
tkinter    # GUI 프레임워크 (Python 내장)
```

### 개발 명령어

```bash
# 애플리케이션 실행
python Container_Audit.py

# 코드 품질 검사
python -m py_compile Container_Audit.py
```

## 🎯 핵심 기능 상세

### ⚙️ 간편한 작업 플로우
- **표준 검사 모드**: 현품표 스캔 → 제품 스캔 → 트레이 완료
- **개별 제품 교환**: 완료된 작업 후 불량품을 양품으로 개별 교환

### 🔌 하드웨어 통합 기능
- **바코드 스캐너**: USB 연결 자동 인식, 실시간 바코드 처리
- **오디오 피드백**: `pygame.mixer` 기반 즉시 음성 안내 (성공/오류음)

### 📊 실시간 데이터 처리
- **실시간 현황판**: 진행률, 당일 통계, 평균 작업시간 표시
- **자동 저장**: 트레이 상태 실시간 저장, 예기치 않은 종료시 복구
- **CSV 로깅**: 모든 검사 이벤트를 `C:\Sync`에 자동 저장

### 🔄 자동 업데이트 시스템
- **GitHub API 연동**: 릴리즈 자동 감지 및 다운로드
- **백그라운드 처리**: 사용자 작업 방해 없이 업데이트 적용
- **버전 관리**: 안전한 업데이트 프로세스

## 📁 파일 구조 및 데이터 관리

### 필수 시스템 디렉토리
```bash
C:\Sync/                           # 필수! 메인 로그 저장소
├── 이적검사이벤트로그_[작업자]_[날짜].csv    # 이적 검사 로그
└── 기타 관련 로그 파일들
```

### 설정 및 자산 파일
```bash
assets/
├── Item.csv          # 제품 DB (필수)
├── *.wav            # 오디오 피드백 파일
└── logo.ico         # 애플리케이션 아이콘

config/
└── container_audit_settings.json  # UI 설정 (스케일, 컬럼 너비)
```

## 🔍 API 및 이벤트 시스템

### 주요 이벤트 타입
```python
# 검사 관련 이벤트
SCAN_SUCCESS              # 바코드 스캔 성공
SCAN_DUPLICATE           # 중복 바코드 스캔
SCAN_MISMATCH           # 품목 불일치
TRAY_PRODUCT_SCANNED    # 트레이 제품 스캔

# 세션 관리 이벤트
SESSION_START           # 검사 세션 시작
SESSION_COMPLETE        # 세션 완료
SESSION_RESET           # 세션 리셋
TRAY_SUBMIT            # 트레이 제출
SESSION_RESTORED        # 세션 복구

# 개별 제품 교환 이벤트
PRODUCT_EXCHANGE_COMPLETED # 제품 교환 완료

# 현품표 교체 이벤트
MASTER_LABEL_REPLACE_START    # 현품표 교체 시작
HISTORICAL_REPLACE_SUCCESS    # 완료된 현품표 교체 성공
MASTER_LABEL_REPLACE_CANCEL   # 현품표 교체 취소

# 시스템 이벤트
UPDATE_CHECK_FOUND      # 업데이트 발견
UPDATE_STARTED          # 업데이트 시작
IDLE_MODE_ON           # 유휴 모드 진입
IDLE_MODE_OFF          # 유휴 모드 해제

# 트레이 관리 이벤트
TRAY_PARKED            # 트레이 보류
TRAY_RESTORED          # 트레이 복구
PARTIAL_TRAY_SUBMITTED # 부분 트레이 제출

# 테스트 관련 이벤트
TEST_TRAY_COMPLETED    # 테스트 트레이 완료
AUTO_TEST_STARTED      # 자동 테스트 시작
```

### 데이터 모델 구조
```python
@dataclass
class TraySession:
    master_label_code: str              # 현품표 바코드
    item_code: str                      # 품목 코드
    item_name: str                      # 품목명
    item_spec: str                      # 품목 규격
    scanned_barcodes: List[str]         # 스캔된 바코드 목록
    scan_times: List[datetime]          # 스캔 시간 목록
    tray_size: int = 60                 # 트레이 크기
    start_time: datetime                # 시작 시간
    is_test_tray: bool = False          # 테스트 여부
    is_partial_submission: bool = False # 부분 제출 여부
    is_restored_session: bool = False   # 복구된 세션 여부

@dataclass
class ProductExchangeSession:
    item_code: str                      # 품목 코드
    item_name: str                      # 품목명
    item_spec: str                      # 품목 규격
    target_quantity: int = 1            # 교환할 수량
    defective_barcodes: List[str]       # 불량품 바코드 목록
    good_barcodes: List[str]            # 양품 바코드 목록
    exchange_pairs: List[Dict]          # 교환 쌍 목록
    current_step: str = "scan_defective" # 현재 단계
```

## 🔧 데이터 이벤트 처리 아키텍처

### 이벤트 로깅 시스템
```python
def _log_event(self, event_type: str, detail: Dict[str, Any] = None):
    """
    모든 시스템 이벤트를 비동기적으로 로깅합니다.

    이벤트 구조:
    - timestamp: 이벤트 발생 시간
    - event_type: 이벤트 타입 (위 이벤트 타입 참조)
    - detail: 이벤트 상세 정보 (JSON 형식)
    - worker: 현재 작업자
    - session_id: 현재 세션 ID
    """
```

### CSV 데이터 구조
```csv
timestamp,event_type,worker,item_code,item_name,master_label,barcode,scan_count,total_quantity,work_time_sec,details
2024-12-24 09:15:30,SESSION_START,작업자1,8811012345678,샘플제품,WID20241224091530,,,0,60,0.0,"{""tray_size"": 60}"
2024-12-24 09:16:45,TRAY_PRODUCT_SCANNED,작업자1,8811012345678,샘플제품,WID20241224091530,8811012345678001,1,60,75.2,"{""scan_time"": ""2024-12-24 09:16:45""}"
2024-12-24 09:45:20,SESSION_COMPLETE,작업자1,8811012345678,샘플제품,WID20241224091530,,60,60,1790.5,"{""completion_type"": ""full""}"
```

### 데이터 흐름 처리
```python
# 1. 바코드 스캔 → 이벤트 생성
process_scan() → _log_event('TRAY_PRODUCT_SCANNED')

# 2. 트레이 완료 → 세션 저장
submit_current_tray() → _log_event('SESSION_COMPLETE') → CSV 저장

# 3. 개별 제품 교환 → 교환 로그
_complete_exchange() → _log_event('PRODUCT_EXCHANGE_COMPLETED')

# 4. 예외 상황 → 오류 로그
exception_handler() → _log_event('ERROR_OCCURRED')
```

## ✨ 주요 기능 목록

* **바코드 기반 검사**: 현품표(마스터 라벨) 스캔으로 작업을 시작하고, 개별 제품 바코드를 스캔하여 검사를 진행합니다.

* **간편한 이적 검사**: 모든 제품이 양품으로 처리되는 간단한 워크플로우로 빠른 검사가 가능합니다.

* **실시간 현황판**: 현재 트레이의 진행 상황, 당일 작업 통계, 평균 작업 시간 등을 실시간으로 확인할 수 있습니다.

* **개별 제품 교환**: 완료된 작업 후 불량품이 발견되면 개별적으로 양품과 교환할 수 있는 기능을 제공합니다.

* **작업 자동 저장 및 복구**: 예기치 않게 프로그램이 종료되어도 진행 중이던 작업 내용을 복구할 수 있습니다.

* **자동 업데이트**: 프로그램 실행 시 새로운 버전이 있으면 자동으로 감지하고 업데이트를 안내합니다.

* **사용자 맞춤 UI**: `Ctrl` + `마우스 휠` 스크롤로 화면 배율을 조절하여 보기 편한 크기로 설정할 수 있습니다.

---

## 🚀 프로그램 사용법

### 1. 작업 시작 및 로그인

1. 폴더에 있는 `Container_Audit.exe` 파일을 실행합니다.
2. 화면에 나타나는 입력창에 **본인의 작업자 이름**을 정확하게 입력합니다.
3. `Enter` 키를 누르거나 '작업 시작' 버튼을 클릭합니다.

> **💡 팁**: 만약 이전에 비정상적으로 종료된 작업이 있다면, "이전 작업 복구" 여부를 묻는 창이 나타납니다. '예'를 누르면 작업 내용을 그대로 이어서 할 수 있습니다.

### 2. 메인 화면 구성

로그인 후 나타나는 메인 화면은 크게 세 부분으로 나뉩니다.

* **(좌측) 작업 현황 패널**:
   * **금일 작업 현황**: 오늘 완료한 품목별 트레이(파렛트) 수량을 보여줍니다.

* **(중앙) 메인 작업 패널**:
   * 현재 검사 중인 품목 정보와 진행률(카운트, 프로그레스 바)이 표시됩니다.
   * 바코드를 스캔하는 메인 입력창이 위치합니다.
   * 스캔된 제품 목록이 나타납니다.

* **(우측) 정보 및 상태 패널**:
   * 현재 시간, 작업 상태, 현재 트레이 소요 시간, 평균 완료 시간, 30일 최고 기록 등이 표시됩니다.

### 3. 표준 검사 절차 (가장 중요!)

**Step 1: 현품표(마스터 라벨) 스캔**

* 작업을 시작할 트레이(파렛트)의 **현품표 QR코드**를 스캔합니다.
* 스캔이 성공하면 중앙 패널에 품목 정보가 표시되고, 검사를 시작할 준비가 완료됩니다.

**Step 2: 제품 바코드 스캔**

* **모든 제품은 양품으로 처리**: 제품 바코드를 스캔하면 자동으로 양품으로 등록됩니다.
* "삑" 하는 성공음과 함께 스캔된 제품 목록에 추가됩니다.

**Step 3: 트레이 작업 완료**

* 현품표에 지정된 수량만큼 스캔을 완료하면 **자동으로 현재 트레이가 제출**되고, 다음 현품표를 스캔할 수 있는 대기 상태로 돌아갑니다.
* 수량에 도달하기 전에 작업을 끝내려면 중앙 하단의 **'✅ 트레이 제출'** 버튼을 누르세요.

### 4. 개별 제품 교환 기능

완료된 작업 후 불량품이 발견되어 교환이 필요한 경우:

1. **교환 시작**: 중앙 패널의 **'🔁 개별 제품 교환'** 버튼을 클릭합니다.
2. **수량 선택**: 교환할 수량을 1~10개 중에서 선택합니다.
3. **불량품 스캔**: '교환 시작' 버튼을 누른 후 불량품 바코드를 스캔합니다.
4. **양품 스캔**: 불량품 스캔이 완료되면 대체할 양품 바코드를 스캔합니다.
5. **교환 완료**: 모든 스캔이 완료되면 '교환 완료' 버튼을 클릭하여 교환을 완료합니다.

### 5. 기타 주요 기능

* **↩️ 마지막 스캔 취소**: 바로 직전에 스캔한 제품을 목록에서 제거합니다.
* **현재 작업 리셋**: 현재 진행 중인 트레이의 모든 스캔 기록을 삭제하고 현품표 스캔 이전 상태로 초기화합니다.
* **⏸️ 트레이 보류**: 현재 작업을 임시 저장하고 다른 작업을 먼저 처리할 수 있습니다.
* **🔄 완료 현품표 교체**: 이미 완료된 현품표의 정보를 수정해야 할 때 사용합니다.
* **작업자 변경**: 현재 작업을 종료하고 다른 작업자가 로그인할 수 있도록 로그인 화면으로 돌아갑니다.

---

## 💡 유용한 팁 및 주의사항

* **UI 크기 조절**: 화면의 글씨나 버튼이 너무 작거나 크다면, 키보드의 `Ctrl` 키를 누른 상태에서 마우스 휠을 위아래로 움직여 보세요. 자신에게 맞는 크기로 조절할 수 있습니다.

* **오류 발생 시**: 스캔한 바코드가 품목과 맞지 않거나, 이미 스캔한 바코드일 경우 **경고음과 함께 전체 화면에 오류 메시지**가 나타납니다. 내용을 확인하고 '확인' 버튼을 눌러 작업을 계속하세요.

* **휴식 모드**: 검사 중 7분(`IDLE_THRESHOLD_SEC = 420`) 이상 활동이 없으면 프로그램은 자동으로 '대기 중' 상태로 전환됩니다. 아무 바코드나 스캔하면 즉시 다시 작업 상태로 돌아옵니다.

---

## ❓ 문제 해결 (FAQ)

* **Q: 프로그램을 실행했는데 `Item.csv` 파일을 찾을 수 없다고 나옵니다.**
   * A: 프로그램 실행 파일(`Container_Audit.exe`)이 있는 폴더에 `assets` 폴더가 있는지, 그 안에 `Item.csv` 파일이 있는지 확인해주세요.

* **Q: 바코드 스캐너가 작동하지 않습니다.**
   * A: 스캐너가 컴퓨터에 제대로 연결되었는지 확인하세요. 메모장에서 바코드를 스캔했을 때 글자가 입력되는지 테스트해보세요.

* **Q: 이미 완료한 현품표를 다시 스캔하니 '작업 중복' 오류가 발생합니다.**
   * A: 시스템은 동일한 현품표의 중복 작업을 방지합니다. 이미 완료된 작업인지 확인하고, 새로운 현품표로 작업을 시작해주세요.

---

## 📂 파일 구조 및 데이터 관리

* **로그 파일 위치**: 모든 검사 기록 및 이벤트 로그는 `C:\Sync` 폴더에 `이적검사이벤트로그_작업자이름_날짜.csv` 형식으로 저장됩니다.

* **데이터 중요성**: 이 로그 파일들은 모든 작업의 증거 자료이므로 **절대로 임의로 수정하거나 삭제하지 마세요.**

* **설정 파일**: 프로그램 창 크기, 스캔 딜레이 등의 설정은 프로그램 폴더 내 `config\container_audit_settings.json` 파일에 저장됩니다.

## 🔒 보안 및 규정 준수

### 데이터 보안
- **로컬 데이터 저장**: 모든 데이터는 `C:\Sync`에 로컬 저장
- **네트워크 통신**: GitHub API 연결시에만 외부 통신
- **바코드 검증**: 입력 데이터 검증으로 보안 위협 방지
- **로그 무결성**: CSV 형식으로 변조 탐지 가능

### 규정 준수
- **데이터 추적성**: ISO 9001 품질관리 시스템 요구사항 준수
- **감사 로그**: 모든 검사 활동 타임스탬프와 함께 기록
- **백업 정책**: 일별 로그 파일 자동 분리로 데이터 손실 방지

## 📞 지원 및 문의

### 기술 지원
- **개발팀 이메일**: [기술지원 이메일 주소]
- **GitHub Issues**: https://github.com/KMTechn/Container_Audit/issues
- **문서**: 이 README.md 파일 참조

### 사용자 교육
- **현장 교육**: 신규 작업자 대상 1:1 교육 지원
- **매뉴얼**: 사용자 가이드 섹션 참조
- **FAQ**: 문제 해결 섹션 참조

---

## 📄 라이센스

**Copyright © 2024 KMTech. All rights reserved.**

본 소프트웨어는 KMTech의 독점 소프트웨어입니다.
라이센스 없이 복제, 배포, 수정을 금지합니다.

**🏭 제작**: KMTech 품질관리팀
**📧 연락처**: [연락처 정보]
**🌐 웹사이트**: [회사 웹사이트]
**📅 최종 업데이트**: 2024-12-24